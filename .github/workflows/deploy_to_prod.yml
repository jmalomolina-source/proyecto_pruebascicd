# Archivo: .github/workflows/deploy_to_prod.yml

name: Despliegue a Carpeta Local PRO

on:
  push:
    branches:
      - main
  workflow_dispatch: 

jobs:
  deploy:
    # Usamos Linux para evitar el error de compatibilidad con SCP/Windows.
    runs-on: ubuntu-latest 
    environment: produccion 

    steps:
      # Paso 1: Descargar el código
      - name: Checkout del repositorio
        uses: actions/checkout@v4

      # Paso 2: Configurar el ambiente Python (Necesario para el paso 3)
      - name: Configurar Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          
      # Paso 3: Instalar las dependencias 
      - name: Instalar dependencias
        run: pip install -r requirements.txt
        
      # -------------------------------------------------------------
      # PASO 4: TRANSFERENCIA DE ARCHIVOS (USANDO CONTRASEÑA)
      # -------------------------------------------------------------
      - name: Transferencia de Código vía SCP a Windows
        uses: appleboy/scp-action@master 
        with:
          # --- Credenciales de Conexión ---
          host: ${{ secrets.SSH_HOST }}        # Tu IP (ej: 192.168.3.90)
          username: ${{ secrets.SSH_USERNAME }}  # Tu nombre de usuario de Windows
          port: 22                             
          
          # 🚨 USAMOS CONTRASEÑA (PASSWORD) EN LUGAR DE CLAVE PRIVADA
          password: ${{ secrets.SSH_PASSWORD }}
          
          # --- Configuración de Transferencia ---
          source: "." # Transfiere todos los archivos del repositorio
          target: "C:/jmalo/FUENTES/GITHUB/fuentes/pro/ejecutable/"
          # Usamos barras inclinadas (/) en la ruta de Windows para compatibilidad con SSH
      